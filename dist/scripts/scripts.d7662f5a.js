"use strict";angular.module("comparateurRisquesApp",["ngAnimate","ngAria","ngMessages","ngRoute","ngSanitize","ngMaterial","angularMoment"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/resultats",{templateUrl:"views/resultats.html",controller:"ResultatsCtrl",controllerAs:"resultats"}).otherwise({redirectTo:"/"})}]).directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){!0===b.$last&&a(function(){b.$emit(d.onFinishRender)})}}}]),angular.module("comparateurRisquesApp").controller("MainCtrl",["$scope","$rootScope","$http","$timeout",function(a,b,c,d){if(void 0===e){var e=[];c.get("data/MOCK_DATA.JSON").then(function(a){e=a.data})}void 0===b.selectedPatients&&(b.selectedPatients=[]),a.minBirthDate=new Date(1930,0,1),a.maxBirthDate=new Date(2017,11,31),a.searchInput={lastName:"",firstName:"",birthDate:""},a.searchPatient=function(){if(""===a.searchInput.birthDate&&a.searchForm.birthDate.$setValidity("valid",!0),a.searchForm.$valid){a.searchResult=e.filter(function(b){var c=new Date(b.admin["date_de _naissance"]);return c.setHours(0,0,0),a.searchInput.firstName.toLowerCase()===b.admin.prenom.toLowerCase()&&a.searchInput.lastName.toLowerCase()===b.admin.nom.toLowerCase()&&(""===a.searchInput.birthDate||a.searchInput.birthDate.getTime()===c.getTime())});for(var c=function(b){return b.id===a.searchResult[f].id},f=0;f<a.searchResult.length;f++){var g=b.selectedPatients.find(c);a.searchResult[f].selected=void 0!==g}a.searchDone=!0,d(function(){a.$apply()})}},a.selectPatient=function(c){a.searchResult[c].selected=!0,b.selectedPatients.push(a.searchResult[c]),d(function(){a.$apply()})},a.unselectPatient=function(c){var d=b.selectedPatients[c].id;if(b.selectedPatients.splice(c,1),void 0!==a.searchResult&&a.searchResult.length>0){var e=a.searchResult.findIndex(function(a){return a.id===d});a.searchResult[e].selected=!1}}}]),angular.module("comparateurRisquesApp").controller("ResultatsCtrl",["$scope","$rootScope","$location","moment",function(a,b,c,d){void 0!==b.selectedPatients&&0!==b.selectedPatients.length||c.path("main");var e=["#4BC0C0","#36A2EB","#FF9F40","#FFCD56"],f=d(),g=d("2017-12-31T23:59:59Z"),h=d("1930-01-01T00:00:00Z"),i={age:{min:f.diff(g,"years"),max:f.diff(h,"years"),unite:"ans"},bmi:{min:45/(1.95*1.95),max:140/(1.55*1.55),unite:""},hba1c:{min:.05,max:.12,unite:"(ratio)"},cholesterol_total:{min:130,max:320,unite:"mg/dl"},cholesterol_hdl:{min:20,max:100,unite:"mg/dl"},pression_sanguine:{min:90,max:200,unite:"mmHg"},consommation_tabagique:{min:0,max:80,unite:"paquets par année"}};a.prepareData=function(a){var b={};for(var c in a)b[c]=(a[c]-i[c].min)/((i[c].max-i[c].min)/100);return b};var j=function(a){return{age:d().diff(d(a.admin["date_de _naissance"]),"years"),bmi:(a.biometrie.poids/(a.biometrie.taille/100*a.biometrie.taille/100)).toFixed(1),hba1c:a.const_biologique.HbA1c,cholesterol_total:a.const_biologique.Cholesterol_total,cholesterol_hdl:a.const_biologique.Cholesterol_HDL,pression_sanguine:a.parametres.PSS,consommation_tabagique:a.assuetudes.Consommation_tabagique}},k=function(){var c=[];return b.selectedPatients.forEach(function(b,d){var f=a.prepareData(j(b)),g={label:b.admin.prenom+" "+b.admin.nom+" ("+b.admin.Genre.substring(0,1)+")",backgroundColor:e[d],borderColor:e[d],data:[f.age,f.bmi,f.hba1c,f.cholesterol_total,f.cholesterol_hdl,f.pression_sanguine,f.consommation_tabagique]};c.push(g)}),c},l=document.getElementById("chart").getContext("2d");new Chart(l,{type:"horizontalBar",data:{labels:["Age","BMI","HbA1c","Cholestérol total","Cholestérol HDL","PSS","Consommation tabagique"],datasets:k()},options:{legend:{labels:{fontSize:16}},scales:{xAxes:[{ticks:{steps:10,max:100,min:0}}]},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(a){var c=a.index,d=a.datasetIndex,e=j(b.selectedPatients[d]);return e[Object.keys(e)[c]]+" "+i[Object.keys(i)[c]].unite}}}}})}]),angular.module("comparateurRisquesApp").run(["$templateCache",function(a){a.put("views/main.html",'<h2>Sélection des patients (1 à 4)</h2> <div class="row group-content"> <h3>Rechercher un patient :</h3> <div class="col-md-12"> <form name="searchForm" class="search-form" id="searchForm" ng-submit="searchPatient()" novalidate> <div class="row"> <div class="form-group col-md-3 col-sm-6"> <label for="firstName">Prénom</label> <input type="text" id="firstName" name="firstName" class="form-control" ng-model="searchInput.firstName" required> <div ng-if="searchForm.$submitted || searchForm.firstName.$dirty" ng-messages="searchForm.firstName.$error"> <div ng-message="required"> Ce champ est requis </div> </div> </div> <div class="form-group col-md-3 col-sm-6"> <label for="lastName">Nom</label> <input type="text" id="lastName" name="lastName" class="form-control" ng-model="searchInput.lastName" required> <div ng-if="searchForm.$submitted || searchForm.lastName.$dirty" ng-messages="searchForm.lastName.$error"> <div ng-message="required"> Ce champ est requis </div> </div> </div> <div class="form-group col-md-3 col-sm-6"> <label for="birthDate">Date de naissance</label> <md-datepicker name="birthDate" id="birthDate" ng-model="searchInput.birthDate" md-min-date="minBirthDate" md-max-date="maxBirthDate" ng-required="false"></md-datepicker> </div> <div class="form-group col-md-3 col-sm-12"> <button class="btn btn-primary" type="submit">Rechercher</button> </div> </div> </form> </div> <div ng-show="searchDone"> <h4>Résultats de la recherche</h4> <table class="table table-stripped"> <thead> <tr> <th> </th> <th> Prénom </th> <th> Nom </th> <th> Date de naissance </th> </tr> </thead> <tbody> <tr ng-repeat="patient in searchResult track by $index"> <td valign="middle"> <button class="btn btn-primary" ng-disabled="patient.selected === true || selectedPatients.length === 4" ng-click="selectPatient($index)"><span class="glyphicon glyphicon-plus"></span></button> </td> <td valign="middle"> {{patient.admin.prenom}} </td> <td valign="middle"> {{patient.admin.nom}} </td> <td valign="middle"> {{patient.admin[\'date_de _naissance\'] | date : \'dd/MM/yyyy\'}} </td> </tr> <tr ng-show="searchResult.length === 0"> <td> </td> <td colspan="3"> Aucun résultat correspondant </td> </tr> </tbody> </table> </div> </div> <div class="row group-content patients-selected" ng-show="selectedPatients.length > 0"> <h3>Patients sélectionnés</h3> <table class="table table-stripped"> <thead> <tr> <th> </th> <th> Prénom </th> <th> Nom </th> <th> Date de naissance </th> </tr> </thead> <tbody> <tr ng-repeat="patient in selectedPatients track by $index"> <td valign="middle"> <button class="btn btn-danger" ng-click="unselectPatient($index)"><span class="glyphicon glyphicon-minus"></span></button> </td> <td valign="middle"> {{patient.admin.prenom}} </td> <td valign="middle"> {{patient.admin.nom}} </td> <td valign="middle"> {{patient.admin[\'date_de _naissance\'] | date : \'dd/MM/yyyy\'}} </td> </tr> </tbody> </table> <a class="btn btn-default" href="#!/resultats">Voir les risques encourus</a> </div>'),a.put("views/resultats.html",'<a href="#!/" class="back-button btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span> Modifier les patients sélectionnés</a> <div class="row"> <div class="col-md-12"> <canvas id="chart"></canvas> </div> </div>')}]);